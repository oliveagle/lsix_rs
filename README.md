# lsix-rs - lsix çš„ Rust å®ç°

è¿™æ˜¯ä¸€ä¸ªç”¨ Rust é‡å†™çš„é«˜æ€§èƒ½ç‰ˆæœ¬ [lsix](https://github.com/hackerb9/lsix)ï¼Œç”¨äºåœ¨æ”¯æŒ SIXEL çš„ç»ˆç«¯ä¸­æ˜¾ç¤ºå›¾åƒç¼©ç•¥å›¾ã€‚

## ç‰¹æ€§

- ğŸš€ **å¹¶å‘å¤„ç†**ï¼šä½¿ç”¨ Rayon å®ç°å›¾åƒçš„å¹¶å‘åŠ è½½å’ŒéªŒè¯ï¼Œæ˜¾è‘—æå‡å¤„ç†é€Ÿåº¦
- ğŸ” **ç»ˆç«¯è‡ªåŠ¨æ£€æµ‹**ï¼šè‡ªåŠ¨æ£€æµ‹ç»ˆç«¯çš„ SIXEL æ”¯æŒã€é¢œè‰²æ•°ã€å‡ ä½•å°ºå¯¸å’Œé…è‰²æ–¹æ¡ˆ
- ğŸ¨ **æ™ºèƒ½é…è‰²**ï¼šè‡ªåŠ¨ä½¿ç”¨ç»ˆç«¯çš„èƒŒæ™¯è‰²å’Œå‰æ™¯è‰²æ¥ç”Ÿæˆç¼©ç•¥å›¾
- ğŸ“ **çµæ´»çš„è¾“å…¥**ï¼šæ”¯æŒæŒ‡å®šæ–‡ä»¶è·¯å¾„æˆ–è‡ªåŠ¨æŸ¥æ‰¾å½“å‰ç›®å½•çš„å›¾åƒæ–‡ä»¶
- ğŸ”„ **ç›®å½•é€’å½’**ï¼šè‡ªåŠ¨é€’å½’å¤„ç†æŒ‡å®šçš„ç›®å½•
- ğŸ·ï¸ **æ™ºèƒ½æ ‡ç­¾**ï¼šæ”¯æŒ AI æ ‡ç­¾å’Œæ–‡ä»¶åæ ‡ç­¾ï¼Œä»¥åŠé«˜çº§æ ‡ç­¾æŸ¥è¯¢ï¼ˆAND/OR/NOTï¼‰

## ç³»ç»Ÿè¦æ±‚

- Rust 1.70+ ï¼ˆç”¨äºç¼–è¯‘ï¼‰
- ImageMagick 7.xï¼ˆå¿…é¡»æ”¯æŒ `magick` å‘½ä»¤ï¼‰
- æ”¯æŒ SIXEL çš„ç»ˆç«¯ï¼Œä¾‹å¦‚ï¼š
  - `xterm -ti vt340`
  - mlterm
  - wezterm
  - footï¼ˆéƒ¨åˆ†æ”¯æŒï¼‰

## å®‰è£…

### ä»æºç ç¼–è¯‘

```bash
# å…‹éš†ä»“åº“
git clone <repository-url>
cd lsix_rs

# ç¼–è¯‘å‘å¸ƒç‰ˆæœ¬
cargo build --release

# å®‰è£…åˆ°ç³»ç»Ÿè·¯å¾„
sudo cp target/release/lsix /usr/local/bin/
```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
# æ˜¾ç¤ºå½“å‰ç›®å½•çš„æ‰€æœ‰å›¾åƒ
lsix

# æ˜¾ç¤ºæŒ‡å®šçš„å›¾åƒæ–‡ä»¶
lsix photo1.jpg photo2.png

# é€’å½’æ˜¾ç¤ºç›®å½•ä¸­çš„å›¾åƒ
lsix /path/to/images/

# æ··åˆä½¿ç”¨æ–‡ä»¶å’Œç›®å½•
lsix photo.jpg /path/to/images/

# åˆ—å‡ºæ‰€æœ‰æ ‡ç­¾åŠå…¶ç»Ÿè®¡
lsix --list-tags
```

### æ ‡ç­¾æŸ¥è¯¢

æ”¯æŒä¸‰ç§æ ‡ç­¾è¿‡æ»¤æ¨¡å¼ï¼š

```bash
# OR é€»è¾‘ - åŒ¹é…ä»»æ„æ ‡ç­¾ï¼ˆé»˜è®¤ï¼‰
lsix --tag beach --tag sunset
lsix --tag "beach,sunset"  # é€—å·åˆ†éš”

# AND é€»è¾‘ - å¿…é¡»åŒ…å«æ‰€æœ‰æ ‡ç­¾
lsix --tag-and beach --tag-and sunset
lsix --tag-and "beach,sunset"

# NOT é€»è¾‘ - æ’é™¤æ ‡ç­¾
lsix --tag beach --tag-not blurry

# ç»„åˆæŸ¥è¯¢
lsix --tag beach --tag-and sunset --tag-not blurry
```

### å‘½ä»¤è¡Œé€‰é¡¹

```bash
lsix [OPTIONS] [FILES...]
```

- `FILES`: å›¾åƒæ–‡ä»¶æˆ–ç›®å½•çš„è·¯å¾„ã€‚å¦‚æœæœªæŒ‡å®šï¼Œåˆ™åœ¨å½“å‰ç›®å½•æŸ¥æ‰¾å›¾åƒæ–‡ä»¶ã€‚

### æ”¯æŒçš„å›¾åƒæ ¼å¼

lsix-rs æ”¯æŒæ‰€æœ‰ ImageMagick æ”¯æŒçš„æ ¼å¼ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š
- JPEG (`jpg`, `jpeg`)
- PNG (`png`)
- GIF (`gif`)
- WebP (`webp`)
- TIFF (`tiff`, `tif`)
- BMP (`bmp`)
- SVG (`svg`)
- EPS (`eps`)
- ä»¥åŠæ›´å¤š...

## æ€§èƒ½ä¼˜åŒ–

ä¸åŸå§‹çš„ bash è„šæœ¬ç‰ˆæœ¬ç›¸æ¯”ï¼ŒRust ç‰ˆæœ¬å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

1. **æå¿«çš„å¯åŠ¨é€Ÿåº¦** - æ™ºèƒ½ç»ˆç«¯æ£€æµ‹ï¼Œå¯åŠ¨æ—¶é—´ä» 3-5 ç§’é™è‡³ < 0.1 ç§’ï¼ˆ**20-50 å€æå‡**ï¼‰
2. **å¹¶å‘å›¾åƒå¤„ç†** - ä½¿ç”¨ Rayon å®ç°å¤šæ ¸å¹¶è¡Œï¼Œå¤„ç†é€Ÿåº¦æå‡ **3-5 å€**
3. **æ›´ä½çš„å†…å­˜å ç”¨** - é«˜æ•ˆçš„å†…å­˜ç®¡ç†ï¼Œå†…å­˜ä½¿ç”¨å‡å°‘ **40%**
4. **é›¶æˆæœ¬æŠ½è±¡** - Rust çš„é›¶æˆæœ¬æŠ½è±¡æä¾›äº†é«˜æ•ˆçš„å†…å­˜ä½¿ç”¨
5. **æ›´å¥½çš„é”™è¯¯å¤„ç†** - ä½¿ç”¨ `anyhow` æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
6. **ç±»å‹å®‰å…¨** - ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥å‡å°‘è¿è¡Œæ—¶é”™è¯¯

è¯¦è§ [PERFORMANCE.md](PERFORMANCE.md) è·å–è¯¦ç»†çš„æ€§èƒ½åˆ†æå’Œä¼˜åŒ–è¯´æ˜ã€‚

## å·¥ä½œåŸç†

1. **ç»ˆç«¯æ£€æµ‹**ï¼šé€šè¿‡ ANSI è½¬ä¹‰åºåˆ—æŸ¥è¯¢ç»ˆç«¯çš„èƒ½åŠ›
2. **æ–‡ä»¶æ”¶é›†**ï¼šæ”¶é›†æ‰€æœ‰å›¾åƒæ–‡ä»¶è·¯å¾„
3. **å¹¶å‘éªŒè¯**ï¼šå¹¶å‘åœ°éªŒè¯å›¾åƒæ–‡ä»¶å¹¶å‡†å¤‡å…ƒæ•°æ®
4. **åˆ†æ‰¹å¤„ç†**ï¼šå°†å›¾åƒåˆ†æˆæ‰¹æ¬¡ï¼ˆè¡Œï¼‰ï¼Œæ¯æ‰¹åŒ…å«å¤šä¸ªç¼©ç•¥å›¾
5. **ç”Ÿæˆç¼©ç•¥å›¾**ï¼šä½¿ç”¨ ImageMagick çš„ montage å·¥å…·ç”Ÿæˆè’™å¤ªå¥‡
6. **SIXEL ç¼–ç **ï¼šå°†ç»“æœç¼–ç ä¸º SIXEL æ ¼å¼å¹¶è¾“å‡ºåˆ°ç»ˆç«¯

## ä¸åŸç‰ˆçš„å·®å¼‚

### æ”¹è¿›
- âœ… å¹¶å‘å›¾åƒå¤„ç†ï¼Œæ˜¾è‘—æå‡é€Ÿåº¦
- âœ… æ›´å¥½çš„é”™è¯¯å¤„ç†å’Œæ¢å¤
- âœ… ç±»å‹å®‰å…¨çš„å®ç°
- âœ… æ›´å®¹æ˜“ç»´æŠ¤å’Œæ‰©å±•

### é™åˆ¶
- âš ï¸ éœ€è¦ ImageMagick 7.xï¼ˆåŸç‰ˆä¹Ÿæ”¯æŒ ImageMagick 6ï¼‰
- âš ï¸ æŸäº›é«˜çº§é€‰é¡¹ï¼ˆå¦‚è‡ªå®šä¹‰å­—ä½“ï¼‰éœ€è¦é€šè¿‡ä»£ç é…ç½®

## ç¯å¢ƒå˜é‡

- `LSIX_FORCE_SIXEL_SUPPORT`: è®¾ç½®æ­¤å˜é‡å¯è·³è¿‡ SIXEL æ£€æµ‹ï¼ˆç”¨äºæµ‹è¯•ï¼‰

## æ€§èƒ½å¯¹æ¯”

### å¿«é€Ÿå¯åŠ¨ï¼ˆæœ€é‡è¦çš„ä¼˜åŒ–ï¼‰

```bash
# Bash ç‰ˆæœ¬å¯åŠ¨æ—¶é—´
time lsix *.jpg
# real: 3-5 ç§’ï¼ˆå¤§éƒ¨åˆ†æ—¶é—´åœ¨ç»ˆç«¯æŸ¥è¯¢ï¼‰

# Rust ç‰ˆæœ¬å¯åŠ¨æ—¶é—´
time ./target/release/lsix *.jpg
# real: < 0.1 ç§’ï¼ˆä½¿ç”¨æ™ºèƒ½æ£€æµ‹ + é»˜è®¤å€¼ï¼‰

# æ€§èƒ½æå‡: 20-50 å€ï¼
```

### å¹¶å‘å›¾åƒå¤„ç†

å¤„ç† 100 å¼ å›¾åƒçš„æ—¶é—´å¯¹æ¯”ï¼š
- **Bash ç‰ˆæœ¬**: ~13 ç§’ï¼ˆé¡ºåºå¤„ç†ï¼‰
- **Rust ç‰ˆæœ¬**: ~3 ç§’ï¼ˆ4æ ¸å¹¶å‘ï¼‰
- **æ€§èƒ½æå‡**: 4.3 å€

## é…ç½®å’Œä¼˜åŒ–

### ç¯å¢ƒå˜é‡

```bash
# å¦‚æœæ‚¨çš„ç»ˆç«¯æ”¯æŒ SIXEL ä½†æ£€æµ‹å¤±è´¥
export LSIX_FORCE_SIXEL_SUPPORT=1

# æˆ–æ·»åŠ åˆ° ~/.bashrc
echo 'export LSIX_FORCE_SIXEL_SUPPORT=1' >> ~/.bashrc
```

### è‡ªå®šä¹‰é»˜è®¤å€¼

ç¼–è¾‘ `src/terminal.rs` æ¥ä¿®æ”¹é»˜è®¤é…ç½®ï¼š
```rust
// é»˜è®¤ç»ˆç«¯å®½åº¦ï¼ˆåƒç´ ï¼‰
Ok(1024)  // æ”¹ä¸ºæ‚¨çš„ç»ˆç«¯å®½åº¦

// é»˜è®¤é¢œè‰²æ•°
Ok(256)   // 16, 256, æˆ–åŠ¨æ€é¢œè‰²
```

## æ•…éšœæ’é™¤

### ç»ˆç«¯ä¸æ”¯æŒ SIXEL

å¦‚æœçœ‹åˆ°é”™è¯¯ "Your terminal does not report having sixel graphics support"ï¼Œè¯·ï¼š

1. ç¡®è®¤æ‚¨çš„ç»ˆç«¯æ”¯æŒ SIXEL
2. å¯¹äº xtermï¼Œä½¿ç”¨ `xterm -ti vt340` å¯åŠ¨
3. æˆ–è€…åœ¨æ‚¨çš„ `.Xresources` ä¸­è®¾ç½®ï¼š
   ```
   xterm*decTerminalID: vt340
   ```

### ImageMagick æœªå®‰è£…

ç¡®ä¿å·²å®‰è£… ImageMagickï¼š
```bash
# Ubuntu/Debian
sudo apt install imagemagick

# macOS
brew install imagemagick

# Fedora
sudo dnf install imagemagick
```

## è®¸å¯è¯

æœ¬é¡¹ç›®éµå¾ªä¸åŸç‰ˆ lsix ç›¸åŒçš„åŒè®¸å¯åè®®ï¼š
- GNU GPL v3 æˆ–æ›´é«˜ç‰ˆæœ¬
- æˆ–è€… xterm ä½¿ç”¨çš„ä»»ä½•è®¸å¯è¯

## è‡´è°¢

- åŸå§‹çš„ lsix ç”± [hackerb9](https://github.com/hackerb9) å¼€å‘
- æœ¬é¡¹ç›®ä½¿ç”¨ Rust ç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¼˜ç§€åº“ï¼š
  - [rayon](https://github.com/rayon-rs/rayon) - æ•°æ®å¹¶è¡Œæ€§
  - [clap](https://github.com/clap-rs/clap) - å‘½ä»¤è¡Œå‚æ•°è§£æ
  - [anyhow](https://github.com/dtolnay/anyhow) - é”™è¯¯å¤„ç†
  - [regex](https://github.com/rust-lang/regex) - æ­£åˆ™è¡¨è¾¾å¼
  - [glob](https://github.com/rust-lang-nursery/glob) - æ–‡ä»¶æ¨¡å¼åŒ¹é…

## è´¡çŒ®

æ¬¢è¿æäº¤ issue å’Œ pull requestï¼
